- name: install github-release commands
  shell: |
    mkdir -p /tmp/ansible_install_github_release_tmp; cd /tmp/ansible_install_github_release_tmp
    if [ ! -f /opt/bin/{{ item.name }} ]; then
      curl https://api.github.com/repos/{{ item.repo }}/releases/latest | \
        jq -r '.assets[] | select(.name | test("linux_amd64")).browser_download_url' | \
        xargs curl -OL
      tar xzvf *.tar.gz || true
      unzip *.zip || true
      rm *.tar.gz *.zip || true
      mv {{ item.path }} /opt/bin/
    fi
  loop:
    - { name: 'ghq', repo: 'x-motemen/ghq', path: 'ghq_linux_amd64/ghq' }
    - { name: 'pt', repo: 'monochromegane/the_platinum_searcher', path: 'pt_linux_amd64/pt' }
    - { name: 'lemonade', repo: 'lemonade-command/lemonade', path: 'lemonade' }
    - { name: 'atcoder-gli', repo: 'cumet04/atcoder-gli', path: 'atcoder-gli_linux_amd64/acg' }

- name: install awscli-v2
  become: true
  block:
    - unarchive:
        src: https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip
        dest: /opt
        remote_src: true
    - file:
        src: /opt/aws/dist/{{ item }}
        dest: /opt/bin/{{ item }}
        state: link
      loop:
        - aws
        - aws_completer

- name: install awscli session manager plugin
  become: true
  apt:
    deb: https://s3.amazonaws.com/session-manager-downloads/plugin/latest/ubuntu_64bit/session-manager-plugin.deb

- name: link diff-highlight
  become: true
  file:
    src: /usr/share/doc/git/contrib/diff-highlight/diff-highlight
    dest: /opt/bin/diff-highlight
    state: link
- name: executable diff-highliht
  become: true
  file:
    path: /usr/share/doc/git/contrib/diff-highlight/diff-highlight
    mode: a+x
